// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.0.x", "debian-openssl-3.0.x", "linux-musl", "linux-musl-openssl-3.0.x", "rhel-openssl-1.0.x", "rhel-openssl-3.0.x", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String?
  name          String
  phone         String?
  role          String    @default("customer") // customer, admin, superadmin
  isActive      Boolean   @default(true)
  permissions   String[]  @default([]) // For granular access control (e.g. ['manage_shop', 'manage_settings'])
  createdById   String?   // Who created this admin (null for first superadmin)
  googleId      String?   @unique // For Google OAuth
  referralCode  String?   @unique // Unique referral code
  
  // Email Verification
  emailVerified     Boolean   @default(false)
  verificationToken String?   @unique
  verificationExpiry DateTime?
  
  // Two-Factor Authentication
  twoFactorEnabled  Boolean   @default(false)
  twoFactorMethod   String?   // 'email' or 'sms'
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  addresses         Address[]
  orders            Order[]
  reviews           Review[]
  wishlists         Wishlist[]
  cart              Cart?
  loyaltyPoints     LoyaltyPoints?
  pointsTransactions PointsTransaction[]
  referralsMade     Referral[]  @relation("ReferrerRelation")
  referredBy        Referral?   @relation("ReferredRelation")
  questions         ProductQuestion[]
  answers           ProductAnswer[]
  sellerProducts    Product[]   @relation("SellerProducts")  // Products this seller owns
  shop              Shop?       // Seller's shop profile (if any)
  sellerApplication SellerApplication? // Seller application (if pending)
  
  // Internal Chat
  sentMessages     InternalMessage[] @relation("SentMessages")
  receivedMessages InternalMessage[] @relation("ReceivedMessages")
  
  // Financial
  payoutRequests   PayoutRequest[]
  refundRequests   RefundRequest[]

  // Performance indexes
  @@index([role])
  @@index([createdAt])
  @@index([isActive])
}

model InternalMessage {
  id        String   @id @default(uuid())
  senderId  String
  receiverId String
  content   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  sender    User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver  User     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([isRead])
}

model Address {
  id            String   @id @default(uuid())
  userId        String?  // Optional for guest checkout
  guestEmail    String?  // Email for guest orders
  name          String
  phone         String
  address       String
  city          String
  district      String
  postalCode    String?
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  orders        Order[]
}

model Category {
  id            String    @id @default(uuid())
  name          String
  slug          String    @unique
  description   String?
  image         String?
  parentId      String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  parent        Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children      Category[] @relation("CategoryHierarchy")
  products      Product[]
}

model Product {
  id            String    @id @default(uuid())
  name          String
  slug          String    @unique
  description   String
  categoryId    String
  sellerId      String?   // Nullable: seller who owns this product (legacy)
  shopId        String?   // Nullable: shop this product belongs to (multi-vendor)
  basePrice     Float
  salePrice     Float?
  images        String    // JSON array of image URLs
  isFeatured    Boolean   @default(false)
  isBestseller  Boolean   @default(false)
  isActive      Boolean   @default(true)
  sizeGuide     String?   // JSON with size chart data
  hasWarranty   Boolean   @default(false)
  warrantyPeriod String?  // e.g., "1 Year", "6 Months", "Lifetime"
  
  // Smart Product Fields
  productType   String    @default("clothing") // clothing, footwear, fragrance, beauty, electronics, general
  metaTitle     String?
  metaDescription String? @db.Text
  metaKeywords  String?   // Comma separated
  variantPricing Boolean @default(false)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  category      Category        @relation(fields: [categoryId], references: [id])
  seller        User?           @relation("SellerProducts", fields: [sellerId], references: [id])
  shop          Shop?           @relation("ShopProducts", fields: [shopId], references: [id])
  variants      ProductVariant[]
  reviews       Review[]
  wishlists     Wishlist[]
  orderItems    OrderItem[]
  cartItems     CartItem[]
  questions     ProductQuestion[]
  flashSales    FlashSaleProduct[]

  // Performance indexes
  @@index([categoryId])
  @@index([sellerId])
  @@index([shopId])
  @@index([isActive, isFeatured])
  @@index([isActive, isBestseller])
  @@index([createdAt])
  @@index([basePrice])
}

model ProductVariant {
  id            String   @id @default(uuid())
  productId     String
  sku           String   @unique
  size          String?
  color         String?
  stock         Int      @default(0)
  price         Float?
  salePrice     Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Cart {
  id            String     @id @default(uuid())
  userId        String     @unique
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items         CartItem[]
}

model CartItem {
  id            String   @id @default(uuid())
  cartId        String
  productId     String
  variantId     String?
  quantity      Int      @default(1)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  cart          Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([productId])
}

model Order {
  id              String    @id @default(uuid())
  orderNumber     String    @unique
  userId          String?   // Optional for guest checkout
  guestEmail      String?   // Email for guest orders
  addressId       String
  name            String?   // Customer name for order
  phone           String?   // Customer phone for order
  subtotal        Float
  shippingCost    Float
  discount        Float     @default(0)
  total           Float
  couponCode      String?
  status          String    @default("pending") // pending, confirmed, processing, shipped, delivered, cancelled
  paymentMethod   String    // sslcommerz, cod
  paymentStatus   String    @default("pending") // pending, paid, failed
  trackingNumber  String?
  notes           String?
  pointsEarned    Int       @default(0) // Loyalty points earned
  pointsRedeemed  Int       @default(0) // Loyalty points used
  paymentConfirmedAt DateTime? // When admin confirmed payment
  receiptSentAt   DateTime?   // When receipt email was sent
  receiptUrl      String?     // URL/path to generated PDF receipt
  verificationCode String?   @unique // 6-char unique code for receipt verification
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User?     @relation(fields: [userId], references: [id])
  address         Address   @relation(fields: [addressId], references: [id])
  items           OrderItem[]
  payment         Payment?
  refundRequests  RefundRequest[]

  // Performance indexes
  @@index([userId])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
  @@index([status, createdAt])
  @@index([verificationCode])
}

model OrderItem {
  id            String   @id @default(uuid())
  orderId       String
  productId     String
  variantInfo   String?  // JSON: {size, color}
  quantity      Int
  price         Float
  createdAt     DateTime @default(now())
  
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model Payment {
  id                String   @id @default(uuid())
  orderId           String   @unique
  transactionId     String?  @unique
  method            String   // sslcommerz, cod
  amount            Float
  status            String   @default("pending") // pending, success, failed, cancelled
  gatewayResponse   String?  // JSON response from SSLCommerz
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  order             Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Coupon {
  id            String    @id @default(uuid())
  code          String    @unique
  description   String?
  discountType  String    // percentage, fixed, free_shipping
  discountValue Float     // 0 for free_shipping type
  minOrderValue Float?
  maxDiscount   Float?
  validFrom     DateTime
  validUntil    DateTime
  usageLimit    Int?
  usedCount     Int       @default(0)
  isActive      Boolean   @default(true)
  autoApply     Boolean   @default(false)  // If true, auto-apply at checkout
  // User targeting
  targetAudience String   @default("all")  // all, new_customers, returning, vip, loyalty_bronze, loyalty_silver, loyalty_gold, loyalty_platinum
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Review {
  id            String   @id @default(uuid())
  productId     String
  userId        String
  rating        Int      // 1-5
  comment       String?
  photos        String?  // JSON array of photo URLs
  isApproved    Boolean  @default(false)
  adminReply    String?  // Admin/seller reply to the review
  adminReplyAt  DateTime? // When admin replied
  adminReplyBy  String?  // Admin ID who replied
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
  @@index([isApproved])
}

model Wishlist {
  id            String   @id @default(uuid())
  userId        String
  productId     String
  shareToken    String?  @unique // For shareable wishlist link
  isPublic      Boolean  @default(false)
  createdAt     DateTime @default(now())
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([userId, productId])
}

// Live Chat Models
model ChatSession {
  id            String        @id @default(uuid())
  sessionId     String        @unique  // Browser session ID
  userId        String?       // Optional - logged in user
  customerName  String        @default("Guest")
  customerEmail String?
  status        String        @default("active") // active, closed, muted
  assignedTo    String?       // Admin ID if assigned
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  messages      ChatMessage[]
}

model ChatMessage {
  id            String      @id @default(uuid())
  sessionId     String
  senderType    String      // customer, admin, system
  senderId      String?     // User ID if admin/logged in customer
  senderName    String
  message       String
  isRead        Boolean     @default(false)
  createdAt     DateTime    @default(now())
  
  session       ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([senderType])
  @@index([isRead])
}

// Chat Restriction - Admin can restrict users from chatting
model ChatRestriction {
  id              String   @id @default(uuid())
  sessionId       String   @unique // The session being restricted
  userId          String?  // User ID if logged in user
  restrictedUntil DateTime // When the restriction ends
  reason          String?  // Reason for restriction
  createdBy       String   // Admin who created the restriction
  createdAt       DateTime @default(now())
}

// Notification Model
model Notification {
  id            String   @id @default(uuid())
  userId        String
  type          String   // order, promotion, stock, chat
  title         String
  message       String
  isRead        Boolean  @default(false)
  link          String?
  createdAt     DateTime @default(now())

  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@index([createdAt])
}

// Flash Sales System
model FlashSale {
  id            String    @id @default(uuid())
  name          String
  description   String?
  discountPercent Float   // Percentage discount
  startTime     DateTime
  endTime       DateTime
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  products      FlashSaleProduct[]
}

model FlashSaleProduct {
  id            String    @id @default(uuid())
  flashSaleId   String
  productId     String
  
  flashSale     FlashSale @relation(fields: [flashSaleId], references: [id], onDelete: Cascade)
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([flashSaleId, productId])
}

// (Loyalty models moved to end of file with enhanced fields)

// Product Questions & Answers
model ProductQuestion {
  id            String   @id @default(uuid())
  productId     String
  userId        String
  question      String
  isAnswered    Boolean  @default(false)
  isVisible     Boolean  @default(true)
  createdAt     DateTime @default(now())
  
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  answers       ProductAnswer[]
}

model ProductAnswer {
  id            String   @id @default(uuid())
  questionId    String
  userId        String
  answer        String
  isOfficial    Boolean  @default(false)  // Admin/seller answer
  isVisible     Boolean  @default(true)
  upvotes       Int      @default(0)
  createdAt     DateTime @default(now())
  
  question      ProductQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// User Testimonials
model Testimonial {
  id            String   @id @default(uuid())
  userId        String?
  name          String
  email         String?
  avatar        String?
  content       String
  rating        Int      @default(5) // 1-5 stars
  location      String?
  isApproved    Boolean  @default(false)
  isFeatured    Boolean  @default(false)
  createdAt     DateTime @default(now())
}

// Newsletter Subscriptions
model NewsletterSubscription {
  id            String   @id @default(uuid())
  email         String   @unique
  name          String?
  isActive      Boolean  @default(true)
  subscribedAt  DateTime @default(now())
  unsubscribedAt DateTime?
}

// Product Comparison Sessions
model ProductComparison {
  id            String   @id @default(uuid())
  sessionId     String   // Browser session for guests
  userId        String?  // Logged in user
  productIds    String   // JSON array of product IDs (max 3)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// Verification codes for email verification and 2FA
model VerificationCode {
  id        String   @id @default(uuid())
  code      String
  type      String   // 'email_verify', 'login_2fa', 'password_reset'
  userId    String?
  email     String?
  phone     String?
  expiresAt DateTime
  used      Boolean  @default(false)
  attempts  Int      @default(0) // Track failed attempts
  payload   Json?    // Optional payload for storing registration data until verified
  createdAt DateTime @default(now())
  
  @@index([email, type])
  @@index([code, type])
}

// Newsletter Subscribers
model NewsletterSubscriber {
  id            String    @id @default(uuid())
  email         String    @unique
  source        String?   // 'footer', 'popup', 'spin_wheel', etc.
  discountCode  String?   // Discount code given on signup
  isActive      Boolean   @default(true)
  confirmedAt   DateTime? // When they confirmed subscription
  unsubscribedAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// ============= LOYALTY & REFERRAL SYSTEM =============

// Admin-controlled Loyalty Settings
model LoyaltySettings {
  id                    String   @id @default(uuid())
  isEnabled             Boolean  @default(true)
  pointsPerTaka         Float    @default(0.1)  // Points earned per Taka spent
  pointsToTakaRatio     Float    @default(10)   // Points needed for 1 Taka discount
  referralBonusReferrer Int      @default(100)  // Points for referrer
  referralBonusReferred Int      @default(50)   // Points for new customer
  minimumRedeemPoints   Int      @default(100)  // Minimum points to redeem
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

// Loyalty Tiers (Bronze, Silver, Gold, Platinum)
model LoyaltyTier {
  id                String   @id @default(uuid())
  name              String   @unique // bronze, silver, gold, platinum
  displayName       String   // Bronze, Silver, Gold, Platinum
  minSpending       Float    // Minimum lifetime spending to reach tier
  discountPercent   Float    @default(0)    // % discount on all orders
  freeShipping      Boolean  @default(false)
  freeShippingMin   Float?   // Min order for free shipping (null = always free)
  pointsMultiplier  Float    @default(1)    // 1x, 1.5x, 2x, 3x points
  prioritySupport   Boolean  @default(false)
  earlyAccess       Boolean  @default(false) // Early access to sales
  exclusiveDeals    Boolean  @default(false)
  birthdayBonus     Int      @default(0)    // Extra points on birthday
  color             String   @default("#CD7F32") // Badge color
  icon              String?  // Icon name or URL
  sortOrder         Int      @default(0)
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  members           LoyaltyPoints[]
}

// User's Loyalty Points & Tier Status
model LoyaltyPoints {
  id              String      @id @default(uuid())
  userId          String      @unique
  tierId          String?
  totalPoints     Int         @default(0)    // Current available points
  lifetimePoints  Int         @default(0)    // All-time earned points
  lifetimeSpent   Float       @default(0)    // Total amount spent (for tier calc)
  redeemedPoints  Int         @default(0)    // Total redeemed
  tierUpdatedAt   DateTime?   // When tier last changed
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  tier            LoyaltyTier? @relation(fields: [tierId], references: [id])
  transactions    PointsTransaction[]
}

// Points Transaction History
model PointsTransaction {
  id            String   @id @default(uuid())
  userId        String
  loyaltyId     String
  type          String   // 'earn', 'redeem', 'bonus', 'referral', 'expired', 'adjustment'
  points        Int      // Positive for earn, negative for redeem
  description   String
  orderId       String?  // Related order if applicable
  expiresAt     DateTime? // Points expiry date
  createdAt     DateTime @default(now())
  
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  loyalty       LoyaltyPoints @relation(fields: [loyaltyId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([loyaltyId])
}

// Referral Tracking
model Referral {
  id            String    @id @default(uuid())
  referrerId    String    // User who made the referral
  referredId    String    @unique // New user who was referred
  referralCode  String    // Code used
  status        String    @default("pending") // pending, completed, expired
  referrerBonus Int       @default(0) // Points awarded to referrer
  referredBonus Int       @default(0) // Points awarded to referred
  completedAt   DateTime? // When first order was placed
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  referrer      User      @relation("ReferrerRelation", fields: [referrerId], references: [id], onDelete: Cascade)
  referred      User      @relation("ReferredRelation", fields: [referredId], references: [id], onDelete: Cascade)
  
  @@index([referrerId])
  @@index([referralCode])
}

// ============= ANNOUNCEMENT SYSTEM =============

// Admin Announcements
model Announcement {
  id            String    @id @default(uuid())
  title         String
  content       String    @db.Text
  type          String    @default("info")   // info, warning, success, promo
  priority      Int       @default(0)        // Higher = more important
  targetAudience String   @default("all")   // all, customers, admins
  isActive      Boolean   @default(true)
  startDate     DateTime  @default(now())
  endDate       DateTime?                   // null = no expiry
  createdBy     String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  dismissals    AnnouncementDismissal[]
}

// Track which users dismissed which announcements
model AnnouncementDismissal {
  id              String       @id @default(uuid())
  announcementId  String
  userId          String?      // null for guests (use sessionId)
  sessionId       String?      // for guests
  dismissedAt     DateTime     @default(now())
  
  announcement    Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  
  @@unique([announcementId, userId])
  @@index([announcementId])
  @@index([userId])
}

// ============= INVENTORY HISTORY =============

model InventoryLog {
  id            String   @id @default(uuid())
  productId     String
  variantId     String?
  previousStock Int
  newStock      Int
  change        Int      // positive for add, negative for deduct
  reason        String   // order, restock, adjustment, return, damaged
  orderId       String?  // if related to an order
  userId        String   // admin who made the change
  notes         String?
  createdAt     DateTime @default(now())
  
  @@index([productId])
  @@index([createdAt])
}

// ============= CONTACT MESSAGES =============

model ContactMessage {
  id          String   @id @default(uuid())
  name        String
  email       String
  phone       String?
  subject     String
  message     String   @db.Text
  isRead      Boolean  @default(false)
  isReplied   Boolean  @default(false)
  adminNotes  String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([isRead])
  @@index([createdAt])
}

// ============= SITE SETTINGS =============

model SiteSettings {
  id                String   @id @default("main")
  
  // Store Info
  storeName         String   @default("CTG Collection")
  storeTagline      String   @default("Premium E-Commerce Store")
  storeDescription  String?  @db.Text
  logo              String?

  // Stats
  stat1Value        String   @default("10,000+")
  stat1Label        String   @default("Products Sold")
  stat2Value        String   @default("5,000+")
  stat2Label        String   @default("Happy Customers")
  stat3Value        String   @default("100+")
  stat3Label        String   @default("Brands")
  stat4Value        String   @default("4.8")
  stat4Label        String   @default("Average Rating")

  // Values/Features
  returnsEnabled    Boolean  @default(true) // Global Return Kill Switch
  
  // Feature Visibility
  showFreeShipping  Boolean  @default(true)
  showEasyReturns   Boolean  @default(true)
  showCOD           Boolean  @default(true)
  showAuthentic     Boolean  @default(true)

  // Feature Text Values
  featureShippingTitle  String   @default("Free Shipping")
  featureShippingDesc   String   @default("Orders over BDT 2,000")
  featureReturnTitle    String   @default("Easy Returns")
  featureReturnDesc     String   @default("7-day return policy")
  featureCODTitle       String   @default("COD Available")
  featureCODDesc        String   @default("Cash on Delivery")
  featureAuthenticTitle String   @default("100% Authentic")
  featureAuthenticDesc  String   @default("Genuine products")

  value1Title       String   @default("Quality First")
  value1Desc        String   @default("We carefully select every product to ensure the highest quality standards.")
  value2Title       String   @default("Fast Delivery")
  value2Desc        String   @default("Nationwide delivery within 2-5 business days.")
  value3Title       String   @default("Customer Love")
  value3Desc        String   @default("Our customers are at the heart of everything we do.")
  value4Title       String   @default("Local Pride")
  value4Desc        String   @default("Proudly serving Bangladesh with the best local and international products.")

  // Contact Info (using original db column names)
  storeEmail        String   @default("support@ctgcollection.com")
  email2            String?
  storePhone        String   @default("+880 1234 567890")
  phone2            String?
  storeAddress      String   @default("Chittagong, Bangladesh")
  addressLine2      String?
  
  // Working Hours
  workingDays       String   @default("Sat - Thu")
  workingHours      String   @default("9AM - 9PM")
  offDays           String   @default("Friday: 3PM - 9PM")
  
  // Social Links
  facebook          String?
  instagram         String?
  twitter           String?
  youtube           String?
  linkedin          String?
  whatsapp          String?
  
  // About Page Content
  aboutTitle        String   @default("About CTG Collection")
  aboutContent      String?  @db.Text
  aboutMission      String?  @db.Text
  aboutVision       String?  @db.Text
  
  // Footer Content
  footerAbout       String?  @db.Text
  copyrightText     String   @default("Â© 2024 CTG Collection. All rights reserved.")
  
  // SEO
  metaTitle         String?
  metaDescription   String?
  metaKeywords      String?
  
  // Other
  googleMapsEmbed   String?  @db.Text
  
  // Chat Settings
  chatStatus        String   @default("online") // online, away, offline
  
  // AI Bot & FAQ Contact Info
  aiContactEmail    String?  @default("support@ctgcollection.com")
  aiContactPhone    String?  @default("+8801991523289")
  supportEmail      String?  @default("support@ctgcollection.com")
  supportPhone      String?  @default("+8801991523289")
  
  // Promo Banner Settings  
  promoEnabled      Boolean  @default(true)
  promoCode         String   @default("WELCOME10")
  promoMessage      String   @default("ðŸŽ‰ Use code WELCOME10 for 10% OFF")
  promoEndTime      DateTime?
  
  // Shipping Settings
  shippingCost      Float    @default(60)
  freeShippingMin   Float    @default(2000)
  
  // Payment Settings
  codEnabled        Boolean  @default(true)
  sslEnabled        Boolean  @default(true)
  
  // Mobile Banking (Personal Send Money)
  bkashEnabled      Boolean  @default(true)
  bkashNumber       String   @default("01991523289")
  nagadEnabled      Boolean  @default(true)
  nagadNumber       String   @default("01991523289")
  rocketEnabled     Boolean  @default(true)
  rocketNumber      String   @default("01991523289")
  
  // Loyalty Points Settings
  pointsPerTaka     Float    @default(0.01)
  pointsValue       Float    @default(0.1)
  
  // Login Settings
  unifiedLogin      Boolean  @default(true) // true = single login page auto-detects role, false = separate admin login
  
  // Multi-Vendor Marketplace Settings
  multiVendorEnabled Boolean @default(false) // true = marketplace with multiple shops, false = single vendor mode
  defaultCommission  Float   @default(5.0)   // Platform commission %
  couponCostPolicy   String  @default("platform") // platform, shop, shared
  
  // Admin Interface Settings
  adminProductMode   String  @default("simple") // simple, advanced

  // PWA & App Controls
  pwaEnabled         Boolean  @default(true)
  pwaPromptDelay     Int      @default(30) // Seconds
  pwaShowInstallLink Boolean  @default(true)

  // Gamification (Spin Wheel)
  spinWheelConfig   Json?    // { enabled: boolean, prizes: [], cooldownMinutes: number }

  updatedAt         DateTime @updatedAt
}

// Site Settings - Key-Value Store for misc settings
model SiteSetting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([key])
}

// ============= MULTI-VENDOR SHOP SYSTEM =============

model Shop {
  id            String    @id @default(uuid())
  ownerId       String    @unique
  name          String
  slug          String    @unique
  description   String?   @db.Text
  logo          String?
  banner        String?
  phone         String?
  email         String?
  address       String?
  city          String?
  isVerified    Boolean   @default(false)
  isActive      Boolean   @default(true)
  rating        Float     @default(0)
  totalSales    Int       @default(0)
  totalProducts Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  owner         User      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  products      Product[] @relation("ShopProducts")
  
  @@index([slug])
  @@index([isActive])
  @@index([ownerId])
}

// ============= SELLER APPLICATION SYSTEM =============

model SellerApplication {
  id              String    @id @default(uuid())
  userId          String    @unique  // Existing user applying
  
  // Shop Details
  shopName        String
  shopDescription String?   @db.Text
  category        String?   // What they plan to sell
  
  // Verification Documents
  nidNumber       String?
  nidImage        String?   // Cloudinary URL
  passportNumber  String?
  passportImage   String?   // Cloudinary URL
  
  // Bank Details (for payouts)
  bankName        String?
  accountName     String?
  accountNumber   String?
  routingNumber   String?
  bkashNumber     String?
  nagadNumber     String?
  
  status          String    @default("pending") // pending, approved, rejected
  rejectionReason String?   @db.Text
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ============= SELLER PAYOUT SYSTEM =============

model PayoutRequest {
  id            String   @id @default(uuid())
  userId        String   // Seller
  amount        Float
  status        String   @default("pending") // pending, approved, rejected, paid
  method        String   // bank, bkash, nagad
  details       String   // Account number/details JSON
  adminNote     String?
  processedAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

// ============= REFUND SYSTEM =============

model RefundRequest {
  id            String   @id @default(uuid())
  orderId       String
  userId        String   // Customer requesting
  amount        Float
  reason        String   @db.Text
  images        String?  // JSON array of image URLs
  status        String   @default("pending") // pending, approved, rejected, refunded
  adminNote     String?
  processedAt   DateTime?
  processedBy   String?  // Admin ID
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status])
  @@index([userId])
}

