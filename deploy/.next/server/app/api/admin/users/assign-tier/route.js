"use strict";(()=>{var e={};e.id=2122,e.ids=[2122,7356,455],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},40909:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{POST:()=>m,dynamic:()=>p});var n=t(49303),i=t(88716),s=t(60670),o=t(87070),u=t(72331),d=t(90455),c=t(36119),l=t(76876);let p="force-dynamic";async function m(e){try{let r=await (0,d.RA)(e);if(!r||"superadmin"!==r.role)return o.NextResponse.json({error:"Unauthorized - Super Admin access required"},{status:403});let{userId:t,tierId:a}=await e.json();if(!t)return o.NextResponse.json({error:"User ID is required"},{status:400});let n=await u.prisma.user.findUnique({where:{id:t},include:{loyaltyPoints:!0}});if(!n)return o.NextResponse.json({error:"User not found"},{status:404});if(a&&!await u.prisma.loyaltyTier.findUnique({where:{id:a}}))return o.NextResponse.json({error:"Tier not found"},{status:404});n.loyaltyPoints?await u.prisma.loyaltyPoints.update({where:{userId:t},data:{tierId:a||null,tierUpdatedAt:new Date}}):await u.prisma.loyaltyPoints.create({data:{userId:t,tierId:a||null,totalPoints:0,lifetimePoints:0,lifetimeSpent:0,redeemedPoints:0,tierUpdatedAt:new Date}});let i=await u.prisma.user.findUnique({where:{id:t},include:{loyaltyPoints:{include:{tier:!0}}}});if(i&&a){let e=i.loyaltyPoints?.tier;e&&i.email&&(await (0,c.sendTierUpdateEmail)(i.email,{customerName:i.name,tierName:e.name,benefits:{Bronze:["Earn 1 point per $1","Birthday Bonus"],Silver:["Earn 1.5 points per $1","Birthday Bonus","Free Shipping"],Gold:["Earn 2 points per $1","Priority Support","Free Shipping","Exclusive Deals"],Platinum:["Earn 3 points per $1","Dedicated Manager","Free Shipping","VIP Access"]}[e.name]||["Exclusive member perks"]}),await (0,l.Eb)(t,e.displayName||e.name))}return o.NextResponse.json({success:!0,message:a?"Tier assigned successfully":"Tier removed successfully",user:i})}catch(e){return console.error("Assign tier error:",e),o.NextResponse.json({error:"Failed to assign tier"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/users/assign-tier/route",pathname:"/api/admin/users/assign-tier",filename:"route",bundlePath:"app/api/admin/users/assign-tier/route"},resolvedPagePath:"C:\\Users\\samia\\Desktop\\Learning Journey\\HostNin\\SilkMartWebSite\\app\\api\\admin\\users\\assign-tier\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:w}=y,x="/api/admin/users/assign-tier/route";function g(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},90455:(e,r,t)=>{t.d(r,{Gv:()=>u,RA:()=>l,V3:()=>d,c_:()=>o,verifyToken:()=>c});var a=t(98691),n=t(6091),i=t(6176);t(71615);let s=new TextEncoder().encode(process.env.JWT_SECRET||"your-secret-key");async function o(e){return a.ZP.hash(e,10)}async function u(e,r){return a.ZP.compare(e,r)}async function d(e){return new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(s)}async function c(e){try{return(await (0,i._)(e,s)).payload}catch(e){return null}}async function l(e){try{let r=e.cookies.get("token")?.value;if(!r)return null;let a=await c(r);if(!a)return null;let{prisma:n}=await t.e(7356).then(t.bind(t,72331)),i=await n.user.findUnique({where:{id:a.userId},select:{id:!0,email:!0,role:!0,name:!0,isActive:!0,permissions:!0}});if(!i||!1===i.isActive)return null;return{id:i.id,userId:i.id,email:i.email,name:i.name,role:i.role,permissions:i.permissions||[]}}catch(e){return console.error("verifyAuth error:",e),null}}},76876:(e,r,t)=>{t.d(r,{A5:()=>y,Eb:()=>h,En:()=>l,KY:()=>w,NF:()=>d,Yp:()=>u,an:()=>o,f_:()=>x,ko:()=>p,oX:()=>f,rB:()=>m,r_:()=>s,wN:()=>c});var a=t(72331);async function n(e,r,t,n,i){try{return await a.prisma.notification.create({data:{userId:e,type:r,title:t,message:n,link:i||null}}),!0}catch(e){return console.error("Failed to create notification:",e),!1}}async function i(e,r,t,n){try{let i=await a.prisma.user.findMany({where:{role:{in:["admin","superadmin"]}},select:{id:!0}});return await Promise.all(i.map(i=>a.prisma.notification.create({data:{userId:i.id,type:e,title:r,message:t,link:n||null}}))),!0}catch(e){return console.error("Failed to notify admins:",e),!1}}async function s(e,r,t){await i("order","\uD83D\uDED2 New Order Received!",`${r} placed an order (৳${t.toLocaleString()})`,"/admin/orders")}async function o(e,r){await n(e,"order","✅ Order Confirmed!","Your order has been confirmed and is being processed.","/dashboard/orders")}async function u(e,r,t){await n(e,"order","\uD83D\uDCE6 Order Shipped!",`Your order is on the way!${t?` Tracking: ${t}`:""}`,"/dashboard/orders")}async function d(e,r){await n(e,"order","\uD83C\uDF89 Order Delivered!","Your order has been delivered. Thank you for shopping with us!","/dashboard/orders")}async function c(e,r,t){await n(e,"order","❌ Order Cancelled",t||"Your order has been cancelled.","/dashboard/orders")}async function l(e,r){await n(e,"welcome","\uD83C\uDF89 Welcome to CTG Collection!",`Hi ${r}, thank you for joining us! Explore our amazing products.`,"/shop")}async function p(e,r){await i("user","\uD83D\uDC64 New User Registered!",`${e} (${r}) just joined.`,"/admin/customers")}async function m(e,r){await i("message","\uD83D\uDCE7 New Contact Message!",`${e}: "${r}"`,"/admin/messages")}async function y(e,r){await i("chat","\uD83D\uDCAC New Chat Message!",`${e} sent a message`,"/admin/chat")}async function f(e,r,t){let a={customer:"Customer",seller:"Seller",admin:"Admin",superadmin:"Super Admin"}[t]||t,i=["admin","seller","superadmin"].includes(t)&&"customer"===r;await n(e,"account",i?"\uD83C\uDF8A Congratulations! Role Upgraded":"\uD83D\uDCCB Account Role Updated",i?`You have been promoted to ${a}! Welcome to the team.`:`Your account role has been changed to ${a}.`,"/dashboard")}async function h(e,r){await n(e,"loyalty","\uD83C\uDFC6 Membership Tier Updated!",`Congratulations! You are now a ${r} member. Enjoy exclusive benefits!`,"/dashboard/loyalty")}async function w(e){await n(e,"account","⚠️ Account Deactivated","Your account has been temporarily deactivated. Please contact support for assistance.",void 0)}async function x(e){await n(e,"account","✅ Account Reactivated","Great news! Your account has been reactivated. Welcome back!","/dashboard")}},72331:(e,r,t)=>{t.d(r,{prisma:()=>i});var a=t(53524);let n=globalThis,i=n.prisma??new a.PrismaClient({log:["error"]});n.prisma=i}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,8691,8840,5245,6119],()=>t(40909));module.exports=a})();