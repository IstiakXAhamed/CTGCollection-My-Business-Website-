"use strict";(()=>{var e={};e.id=1754,e.ids=[1754,7356],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},68874:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>q,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>d,PUT:()=>l,dynamic:()=>p});var a=t(49303),i=t(88716),n=t(60670),o=t(87070),u=t(72331);let p="force-dynamic";async function d(e){try{let{searchParams:r}=new URL(e.url),t=r.get("status"),s={};t&&"all"!==t&&(s.status=t);let a=await u.prisma.refundRequest.findMany({where:s,include:{user:{select:{name:!0,email:!0}},order:{select:{orderNumber:!0,total:!0,paymentMethod:!0}}},orderBy:{createdAt:"desc"}});return o.NextResponse.json({refunds:a})}catch(e){return o.NextResponse.json({error:"Failed"},{status:500})}}async function l(e){try{let{id:r,action:s,note:a}=await e.json();if(!r||!s)return o.NextResponse.json({error:"Missing fields"},{status:400});let i=await fetch(new URL("/api/auth/me",e.url),{headers:e.headers}),n=await i.json(),p=n.user?.id,d="pending";"approve"===s&&(d="approved"),"reject"===s&&(d="rejected"),"refund_processed"===s&&(d="refunded");let l=await u.prisma.refundRequest.update({where:{id:r},data:{status:d,adminNote:a,processedAt:new Date,processedBy:p},include:{user:{select:{email:!0}},order:{select:{orderNumber:!0}}}});return l.user?.email&&"pending"!==d&&Promise.all([t.e(5245),t.e(6119)]).then(t.bind(t,36119)).then(({sendRefundStatusEmail:e})=>{e(l.user.email,l.order.orderNumber,d,a).catch(console.error)}),o.NextResponse.json({success:!0,refund:l})}catch(e){return o.NextResponse.json({error:"Failed"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/refunds/route",pathname:"/api/admin/refunds",filename:"route",bundlePath:"app/api/admin/refunds/route"},resolvedPagePath:"C:\\Users\\samia\\Desktop\\Learning Journey\\HostNin\\SilkMartWebSite\\app\\api\\admin\\refunds\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:h}=c,f="/api/admin/refunds/route";function q(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:x})}},72331:(e,r,t)=>{t.d(r,{prisma:()=>i});var s=t(53524);let a=globalThis,i=a.prisma??new s.PrismaClient({log:["error"]});a.prisma=i}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972],()=>t(68874));module.exports=s})();