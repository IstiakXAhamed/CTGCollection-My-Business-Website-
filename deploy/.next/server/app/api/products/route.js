"use strict";(()=>{var e={};e.id=9684,e.ids=[9684,7356],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77449:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>u,dynamic:()=>l});var a=r(49303),o=r(88716),i=r(60670),n=r(87070),c=r(72331);let l="force-dynamic",p=c.prisma;async function u(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),s=parseInt(t.get("limit")||"12"),a=(r-1)*s,o=t.get("slug"),i=t.get("category"),c=t.get("search"),l=t.get("minPrice"),u=t.get("maxPrice"),d=t.get("featured"),g=t.get("bestseller"),m=t.get("sortBy")||"createdAt",h=t.get("order")||"desc",P={isActive:!0};o&&(P.slug=o),i&&"All"!==i&&(P.category={name:i}),c&&(P.OR=[{name:{contains:c,mode:"insensitive"}},{description:{contains:c,mode:"insensitive"}}]),(l||u)&&(P.basePrice={},l&&(P.basePrice.gte=parseFloat(l)),u&&(P.basePrice.lte=parseFloat(u))),"true"===d&&(P.isFeatured=!0),"true"===g&&(P.isBestseller=!0);let v={};"price"===m?v.salePrice=h:"name"===m?v.name=h:v.createdAt=h,console.log("Fetching products with where:",JSON.stringify(P));let[y,x]=await Promise.all([p.product.findMany({where:P,include:{category:{select:{id:!0,name:!0,slug:!0}},shop:{select:{id:!0,name:!0,slug:!0,logo:!0}},variants:{select:{id:!0,size:!0,color:!0,stock:!0,sku:!0}},reviews:{where:{isApproved:!0},include:{user:{select:{name:!0}}},orderBy:{createdAt:"desc"}}},orderBy:v,skip:a,take:s}),p.product.count({where:P})]);console.log("Found products:",x);let f=await p.siteSettings.findFirst(),A=f?.multiVendorEnabled??!0,w=y.map(e=>{let t=[];try{let r=(e.images||"[]").replace(/\\"/g,'"');t=JSON.parse(r)}catch(e){console.error("Image parse error:",e),t=[]}let r=A?e.shop:null;return{...e,images:t,shop:r}});return n.NextResponse.json({products:w,pagination:{page:r,limit:s,total:x,totalPages:Math.ceil(x/s)}})}catch(e){return console.error("Products API error:",e),n.NextResponse.json({error:e.message||"Failed to fetch products"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"C:\\Users\\samia\\Desktop\\Learning Journey\\HostNin\\SilkMartWebSite\\app\\api\\products\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:h}=d,P="/api/products/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},72331:(e,t,r)=>{r.d(t,{prisma:()=>o});var s=r(53524);let a=globalThis,o=a.prisma??new s.PrismaClient({log:["error"]});a.prisma=o}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972],()=>r(77449));module.exports=s})();