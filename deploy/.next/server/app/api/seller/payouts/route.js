"use strict";(()=>{var e={};e.id=1551,e.ids=[1551,7356],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},67864:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>l,POST:()=>d,dynamic:()=>p});var s=r(49303),o=r(88716),i=r(60670),n=r(87070),u=r(72331);let p="force-dynamic";async function l(e){try{let t=await fetch(new URL("/api/auth/me",e.url),{headers:e.headers}),r=await t.json();if(!r.authenticated||"seller"!==r.user.role)return n.NextResponse.json({error:"Unauthorized"},{status:401});let a=r.user.id,s=await u.prisma.payoutRequest.findMany({where:{userId:a},orderBy:{createdAt:"desc"}}),o=await u.prisma.shop.findUnique({where:{ownerId:a},select:{totalSales:!0}});o?.totalSales;let i=(await u.prisma.orderItem.aggregate({where:{product:{sellerId:a},order:{paymentStatus:"paid"}},_sum:{price:!0}}))._sum.price||0,p=.95*i,l=s.filter(e=>"approved"===e.status||"paid"===e.status).reduce((e,t)=>e+t.amount,0),d=s.filter(e=>"pending"===e.status).reduce((e,t)=>e+t.amount,0),c=p-l-d;return n.NextResponse.json({payouts:s,stats:{totalRevenue:i,netEarnings:p,totalWithdrawn:l,pendingWithdrawals:d,availableBalance:Math.max(0,c)}})}catch(e){return console.error("Payout fetch error:",e),n.NextResponse.json({error:"Failed"},{status:500})}}async function d(e){try{let{amount:t,method:r,details:a}=await e.json();if(!t||t<500)return n.NextResponse.json({error:"Minimum withdrawal is 500 BDT"},{status:400});let s=await fetch(new URL("/api/auth/me",e.url),{headers:e.headers}),o=await s.json();if(!o.authenticated||"seller"!==o.user.role)return n.NextResponse.json({error:"Unauthorized"},{status:401});let i=o.user.id,p=await u.prisma.payoutRequest.create({data:{userId:i,amount:parseFloat(t),method:r,details:JSON.stringify(a),status:"pending"}});return n.NextResponse.json({success:!0,request:p})}catch(e){return console.error("Payout request error:",e),n.NextResponse.json({error:"Failed"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/seller/payouts/route",pathname:"/api/seller/payouts",filename:"route",bundlePath:"app/api/seller/payouts/route"},resolvedPagePath:"C:\\Users\\samia\\Desktop\\Learning Journey\\HostNin\\SilkMartWebSite\\app\\api\\seller\\payouts\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:y}=c,w="/api/seller/payouts/route";function f(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},72331:(e,t,r)=>{r.d(t,{prisma:()=>o});var a=r(53524);let s=globalThis,o=s.prisma??new a.PrismaClient({log:["error"]});s.prisma=o}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[8948,5972],()=>r(67864));module.exports=a})();