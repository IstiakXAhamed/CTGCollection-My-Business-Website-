"use strict";(()=>{var e={};e.id=5014,e.ids=[5014,7356],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9204:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{POST:()=>u,dynamic:()=>d});var r=t(49303),i=t(88716),o=t(60670),n=t(87070),p=t(72331);let d="force-dynamic",c={storeId:process.env.SSLCOMMERZ_STORE_ID||"test_store",storePassword:process.env.SSLCOMMERZ_STORE_PASSWORD||"test_password",isLive:"true"===process.env.SSLCOMMERZ_IS_LIVE,apiUrl:"true"===process.env.SSLCOMMERZ_IS_LIVE?"https://securepay.sslcommerz.com":"https://sandbox.sslcommerz.com"};async function u(e){try{let{orderId:s,amount:t,customerInfo:a}=await e.json();if(!s||!t)return n.NextResponse.json({message:"Missing required fields"},{status:400});let r=await p.prisma.order.findUnique({where:{id:s},include:{address:!0}});if(!r)return n.NextResponse.json({message:"Order not found"},{status:404});let i=`TXN${Date.now()}`,o={store_id:c.storeId,store_passwd:c.storePassword,total_amount:t,currency:"BDT",tran_id:i,success_url:"http://localhost:3000/api/payment/success",fail_url:"http://localhost:3000/api/payment/fail",cancel_url:"http://localhost:3000/api/payment/cancel",ipn_url:"http://localhost:3000/api/payment/ipn",cus_name:a?.name||r.address?.name||"Customer",cus_email:a?.email||"customer@example.com",cus_add1:r.address?.address||"N/A",cus_city:r.address?.city||"Dhaka",cus_state:r.address?.district||"Dhaka",cus_postcode:r.address?.postalCode||"1000",cus_country:"Bangladesh",cus_phone:r.address?.phone||a?.phone||"01700000000",shipping_method:"Courier",ship_name:a?.name||r.address?.name||"Customer",ship_add1:r.address?.address||"N/A",ship_city:r.address?.city||"Dhaka",ship_state:r.address?.district||"Dhaka",ship_postcode:r.address?.postalCode||"1000",ship_country:"Bangladesh",product_name:"Order Items",product_category:"General",product_profile:"general"},d=await fetch(`${c.apiUrl}/gwprocess/v4/api.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(o).toString()}),u=await d.json();if("SUCCESS"===u.status)return await p.prisma.payment.updateMany({where:{orderId:s},data:{transactionId:i,gatewayResponse:JSON.stringify(u)}}),n.NextResponse.json({success:!0,GatewayPageURL:u.GatewayPageURL,sessionKey:u.sessionkey,tranId:i});throw Error(u.failedreason||"Payment initialization failed")}catch(e){return console.error("Payment initialization error:",e),n.NextResponse.json({message:e.message||"Failed to initialize payment"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/payment/init/route",pathname:"/api/payment/init",filename:"route",bundlePath:"app/api/payment/init/route"},resolvedPagePath:"C:\\Users\\samia\\Desktop\\Learning Journey\\HostNin\\SilkMartWebSite\\app\\api\\payment\\init\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:y}=l,_="/api/payment/init/route";function g(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},72331:(e,s,t)=>{t.d(s,{prisma:()=>i});var a=t(53524);let r=globalThis,i=r.prisma??new a.PrismaClient({log:["error"]});r.prisma=i}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[8948,5972],()=>t(9204));module.exports=a})();