"use strict";exports.id=3182,exports.ids=[3182],exports.modules={93182:(e,s,a)=>{a.d(s,{B:()=>w});var t=a(10326),l=a(17577),r=a(83855),n=a(88307),i=a(86333),d=a(39447),c=a(67211),o=a(56418),x=a(69436),m=a(79635),f=a(90772),h=a(54432),u=a(65685),g=a(4720),p=a(77863);let j=l.forwardRef(({className:e,...s},a)=>t.jsx(g.fC,{ref:a,className:(0,p.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));j.displayName=g.fC.displayName,l.forwardRef(({className:e,...s},a)=>t.jsx(g.Ee,{ref:a,className:(0,p.cn)("aspect-square h-full w-full",e),...s})).displayName=g.Ee.displayName;let N=l.forwardRef(({className:e,...s},a)=>t.jsx(g.NY,{ref:a,className:(0,p.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));N.displayName=g.NY.displayName;var b=a(567),y=a(62288),v=a(83159);function w(){let[e,s]=(0,l.useState)([]),[a,g]=(0,l.useState)(null),[p,w]=(0,l.useState)([]),[S,C]=(0,l.useState)(""),[k,z]=(0,l.useState)(!0),[R,Z]=(0,l.useState)(!1),[$,D]=(0,l.useState)(!1),[I,A]=(0,l.useState)(""),[M,V]=(0,l.useState)([]),[O,T]=(0,l.useState)(!1),Y=(0,l.useRef)(null),[q,F]=(0,l.useState)(""),K=async()=>{try{let e=await fetch("/api/internal-chat/conversations");if(e.ok){let a=await e.json();s(a.conversations||[])}}catch(e){console.error("Failed to fetch conversations")}finally{z(!1)}},E=async()=>{if(a)try{let e=await fetch(`/api/internal-chat/messages?userId=${a.id}`);if(e.ok){let s=await e.json();w(s.messages||[]),K()}}catch(e){console.error("Failed to fetch messages")}},B=async()=>{if(!a||!S.trim())return;let e={id:Date.now().toString(),content:S,createdAt:new Date().toISOString(),senderId:q,isRead:!1};w(s=>[...s,e]),C(""),Z(!0);try{(await fetch("/api/internal-chat/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:a.id,content:e.content})})).ok&&(E(),K())}catch(e){console.error("Send failed")}finally{Z(!1)}},_=a=>{g(a),D(!1),e.find(e=>e.user.id===a.id)||s(e=>[{user:a,lastMessage:{content:"",createdAt:new Date().toISOString(),isRead:!0,amISender:!0},unreadCount:0},...e])};return(0,t.jsxs)("div",{className:"flex h-[600px] w-full border rounded-xl overflow-hidden bg-white shadow-sm relative",children:[(0,t.jsxs)("div",{className:`${a?"hidden md:flex":"flex"} w-full md:w-80 border-r bg-gray-50 flex-col md:flex`,children:[(0,t.jsxs)("div",{className:"p-4 border-b flex items-center justify-between bg-white",children:[t.jsx("h2",{className:"font-semibold text-gray-800",children:"Messages"}),(0,t.jsxs)(y.Vq,{open:$,onOpenChange:D,children:[t.jsx(y.hg,{asChild:!0,children:t.jsx(f.z,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full hover:bg-gray-100",children:t.jsx(r.Z,{className:"h-5 w-5 text-blue-600"})})}),(0,t.jsxs)(y.cZ,{children:[t.jsx(y.fK,{children:t.jsx(y.$N,{children:"New Message"})}),(0,t.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,t.jsxs)("div",{className:"relative",children:[t.jsx(n.Z,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx(h.I,{placeholder:"Search people...",className:"pl-9",value:I,onChange:e=>A(e.target.value)})]}),t.jsx(u.x,{className:"h-[300px]",children:O?t.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"Searching..."}):M.length>0?t.jsx("div",{className:"space-y-2",children:M.map(e=>(0,t.jsxs)("div",{onClick:()=>_(e),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 cursor-pointer transition select-none",children:[t.jsx(j,{className:"h-10 w-10",children:t.jsx(N,{className:"bg-blue-100 text-blue-600",children:e.name.charAt(0)})}),(0,t.jsxs)("div",{children:[t.jsx("p",{className:"font-medium text-sm",children:e.name}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[t.jsx(b.C,{variant:"outline",className:"text-[10px] py-0 h-4",children:e.role}),t.jsx("span",{className:"text-xs text-gray-400",children:e.email})]})]})]},e.id))}):I?t.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No users found."}):t.jsx("div",{className:"p-4 text-center text-sm text-gray-400",children:"Type to search admins or sellers."})})]})]})]})]}),t.jsx(u.x,{className:"flex-1",children:0!==e.length||k?t.jsx("div",{className:"flex flex-col",children:e.map(e=>(0,t.jsxs)("div",{onClick:()=>g(e.user),className:`p-4 border-b flex gap-3 cursor-pointer transition hover:bg-gray-100 ${a?.id===e.user.id?"bg-blue-50 border-l-4 border-l-blue-600 hover:bg-blue-50":"border-l-4 border-l-transparent"}`,children:[t.jsx(j,{children:t.jsx(N,{className:a?.id===e.user.id?"bg-blue-200 text-blue-800":"bg-gray-200",children:e.user.name.charAt(0)})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("span",{className:`font-medium truncate ${e.unreadCount>0?"text-black":"text-gray-700"}`,children:e.user.name}),e.lastMessage.createdAt&&t.jsx("span",{className:"text-[10px] text-gray-400 whitespace-nowrap ml-2",children:(0,v.Q)(new Date(e.lastMessage.createdAt),{addSuffix:!1})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("p",{className:`text-xs truncate max-w-[140px] ${e.unreadCount>0?"font-semibold text-gray-900":"text-gray-500"}`,children:[e.lastMessage.amISender&&"You: ",e.lastMessage.content]}),e.unreadCount>0&&t.jsx("span",{className:"h-5 w-5 bg-blue-600 text-white text-[10px] rounded-full flex items-center justify-center font-bold",children:e.unreadCount})]})]})]},e.user.id))}):(0,t.jsxs)("div",{className:"p-8 text-center text-sm text-gray-500",children:["No messages yet.",t.jsx("br",{}),"Start a new chat!"]})})]}),t.jsx("div",{className:`${a?"flex":"hidden md:flex"} flex-1 flex-col bg-slate-50 w-full`,children:a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"h-16 border-b bg-white flex items-center justify-between px-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx(f.z,{variant:"ghost",size:"icon",className:"md:hidden -ml-2",onClick:()=>g(null),children:t.jsx(i.Z,{className:"h-5 w-5"})}),t.jsx(j,{className:"h-10 w-10",children:t.jsx(N,{className:"bg-blue-600 text-white",children:a.name.charAt(0)})}),(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"font-semibold text-gray-800",children:a.name}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500"}),t.jsx("span",{className:"text-xs text-gray-500 capitalize",children:a.role})]})]})]}),t.jsx(f.z,{variant:"ghost",size:"icon",children:t.jsx(d.Z,{className:"h-5 w-5 text-gray-500"})})]}),t.jsx(u.x,{className:"flex-1 p-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[p.map((e,s)=>{let a=e.senderId===q;return t.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:`max-w-[70%] p-3 rounded-2xl shadow-sm text-sm ${a?"bg-blue-600 text-white rounded-br-none":"bg-white text-gray-800 border rounded-bl-none"}`,children:[t.jsx("p",{children:e.content}),(0,t.jsxs)("div",{className:`text-[10px] mt-1 flex items-center justify-end gap-1 ${a?"text-blue-200":"text-gray-400"}`,children:[new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a&&(e.isRead?t.jsx(c.Z,{className:"h-3 w-3"}):t.jsx("span",{className:"text-[10px]",children:"âœ“"}))]})]})},e.id)}),t.jsx("div",{ref:Y})]})}),t.jsx("div",{className:"p-4 bg-white border-t",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[t.jsx(f.z,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:t.jsx(o.Z,{className:"h-5 w-5"})}),t.jsx(h.I,{value:S,onChange:e=>C(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&B(),placeholder:"Type a message...",className:"flex-1 bg-gray-50 border-gray-200 focus:bg-white transition-colors"}),t.jsx(f.z,{onClick:B,disabled:!S.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white w-10 h-10 p-0 rounded-lg",children:t.jsx(x.Z,{className:"h-5 w-5 ml-0.5"})})]})})]}):(0,t.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:t.jsx(m.Z,{className:"h-10 w-10 text-gray-300"})}),t.jsx("p",{className:"font-medium",children:"Select a conversation to start chatting"})]})})]})}},567:(e,s,a)=>{a.d(s,{C:()=>i});var t=a(10326);a(17577);var l=a(79360),r=a(77863);let n=(0,l.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:e,variant:s,...a}){return t.jsx("div",{className:(0,r.cn)(n({variant:s}),e),...a})}},62288:(e,s,a)=>{a.d(s,{$N:()=>u,Be:()=>g,Vq:()=>d,cN:()=>h,cZ:()=>m,fK:()=>f,hg:()=>c});var t=a(10326),l=a(17577),r=a(37956),n=a(94019),i=a(77863);let d=r.fC,c=r.xz,o=r.h_;r.x8;let x=l.forwardRef(({className:e,...s},a)=>t.jsx(r.aV,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));x.displayName=r.aV.displayName;let m=l.forwardRef(({className:e,children:s,...a},l)=>(0,t.jsxs)(o,{children:[t.jsx(x,{}),(0,t.jsxs)(r.VY,{ref:l,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[s,(0,t.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(n.Z,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));m.displayName=r.VY.displayName;let f=({className:e,...s})=>t.jsx("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});f.displayName="DialogHeader";let h=({className:e,...s})=>t.jsx("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});h.displayName="DialogFooter";let u=l.forwardRef(({className:e,...s},a)=>t.jsx(r.Dx,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));u.displayName=r.Dx.displayName;let g=l.forwardRef(({className:e,...s},a)=>t.jsx(r.dk,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",e),...s}));g.displayName=r.dk.displayName},65685:(e,s,a)=>{a.d(s,{x:()=>i});var t=a(10326),l=a(17577),r=a(88691),n=a(77863);let i=l.forwardRef(({className:e,children:s,...a},l)=>(0,t.jsxs)(r.fC,{ref:l,className:(0,n.cn)("relative overflow-hidden",e),...a,children:[t.jsx(r.l_,{className:"h-full w-full rounded-[inherit]",children:s}),t.jsx(d,{}),t.jsx(r.Ns,{})]}));i.displayName=r.fC.displayName;let d=l.forwardRef(({className:e,orientation:s="vertical",...a},l)=>t.jsx(r.gb,{ref:l,orientation:s,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...a,children:t.jsx(r.q4,{className:"relative flex-1 rounded-full bg-border"})}));d.displayName=r.gb.displayName}};