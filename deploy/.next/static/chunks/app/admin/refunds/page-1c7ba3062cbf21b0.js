(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8621],{9928:function(e,s,t){Promise.resolve().then(t.bind(t,41318))},41318:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return g}});var a=t(57437),n=t(2265),r=t(66070),i=t(62869),c=t(35974),l=t(84190),d=t(26815),o=t(76818),u=t(26110),m=t(94508),x=t(51817),h=t(14064),p=t(53113),f=t(71533),j=t(35153);function g(){let{toast:e}=(0,j.pm)(),[s,t]=(0,n.useState)(!0),[g,v]=(0,n.useState)([]),[N,y]=(0,n.useState)("all"),[b,k]=(0,n.useState)(null),[C,w]=(0,n.useState)(""),[R,_]=(0,n.useState)(""),[Z,z]=(0,n.useState)(!1),q=async()=>{try{t(!0);let e=await fetch("/api/admin/refunds?status=".concat(N));if(e.ok){let s=await e.json();v(s.refunds||[])}}finally{t(!1)}};(0,n.useEffect)(()=>{q()},[N]);let S=(e,s)=>{k(e),w(s),_("")},O=async()=>{if(b&&C){z(!0);try{(await fetch("/api/admin/refunds",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:b.id,action:C,note:R})})).ok?(e({title:"Success",description:"Refund request ".concat(C,"ed successfully")}),q(),k(null)):e({title:"Failed",variant:"destructive"})}catch(s){e({title:"Error",variant:"destructive"})}finally{z(!1)}}},T=e=>{switch(e){case"refunded":return"bg-green-100 text-green-700";case"approved":return"bg-blue-100 text-blue-700";case"rejected":return"bg-red-100 text-red-700";default:return"bg-orange-100 text-orange-700"}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Refund Requests"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage customer return and refund requests"})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 bg-white p-1 rounded-lg border",children:["all","pending","approved","refunded","rejected"].map(e=>(0,a.jsx)("button",{onClick:()=>y(e),className:"px-3 py-1.5 text-sm rounded-md capitalize transition ".concat(N===e?"bg-gray-100 font-medium text-gray-900":"text-gray-500 hover:text-gray-700"),children:e},e))})]}),(0,a.jsx)(r.Zb,{children:(0,a.jsx)(r.aY,{className:"p-0",children:s?(0,a.jsx)("div",{className:"p-12 flex justify-center",children:(0,a.jsx)(x.Z,{className:"animate-spin text-gray-400"})}):0===g.length?(0,a.jsx)("div",{className:"p-12 text-center text-gray-500",children:"No requests found"}):(0,a.jsx)("div",{className:"divide-y",children:g.map(e=>{var s,t,n;return(0,a.jsxs)("div",{className:"p-4 flex flex-col sm:flex-row gap-4 items-start sm:items-center hover:bg-gray-50 transition",children:[(0,a.jsx)("div",{className:"p-2 rounded-full hidden sm:block ".concat(T(e.status)),children:(0,a.jsx)(h.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-900 truncate",children:["Order #",null===(s=e.order)||void 0===s?void 0:s.orderNumber]}),(0,a.jsx)("span",{className:"sm:hidden text-sm font-bold",children:(0,m.T4)(e.amount)})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:["Customer: ",null===(t=e.user)||void 0===t?void 0:t.name," (",null===(n=e.user)||void 0===n?void 0:n.email,")"]}),(0,a.jsxs)("div",{className:"mt-2 text-sm bg-gray-100 p-2 rounded-md",children:[(0,a.jsx)("span",{className:"font-semibold text-xs text-gray-500 uppercase block mb-1",children:"Reason:"}),e.reason]}),e.images&&"[]"!==e.images&&(0,a.jsx)("div",{className:"mt-2 flex gap-2",children:(0,a.jsxs)(c.C,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(p.Z,{className:"w-3 h-3 mr-1"})," Check Images"]})})]}),(0,a.jsxs)("div",{className:"hidden sm:block text-right",children:[(0,a.jsx)("p",{className:"font-bold text-lg",children:(0,m.T4)(e.amount)}),(0,a.jsx)(c.C,{className:"capitalize mt-1 ".concat(T(e.status)," hover:bg-opacity-80"),children:e.status})]}),(0,a.jsxs)("div",{className:"flex sm:hidden items-center justify-between w-full mt-2 pt-2 border-t",children:[(0,a.jsx)(c.C,{className:"capitalize ".concat(T(e.status)),children:e.status}),"pending"===e.status&&(0,a.jsx)(i.z,{size:"sm",variant:"outline",onClick:()=>S(e,"approve"),children:"Review"})]}),(0,a.jsx)("div",{className:"hidden sm:block",children:(0,a.jsxs)(l.h_,{children:[(0,a.jsx)(l.$F,{asChild:!0,children:(0,a.jsx)(i.z,{variant:"ghost",size:"icon",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})})}),(0,a.jsxs)(l.AW,{align:"end",children:[(0,a.jsx)(l.Ju,{children:"Actions"}),(0,a.jsx)(l.VD,{}),"pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Xi,{onClick:()=>S(e,"approve"),children:"Approve Request"}),(0,a.jsx)(l.Xi,{onClick:()=>S(e,"reject"),className:"text-red-600",children:"Reject Request"})]}),"approved"===e.status&&(0,a.jsx)(l.Xi,{onClick:()=>S(e,"refund_processed"),children:"Mark Refunded"}),(0,a.jsx)(l.Xi,{onClick:()=>navigator.clipboard.writeText(e.orderId),children:"Copy Order ID"})]})]})})]},e.id)})})})}),(0,a.jsx)(u.Vq,{open:!!b,onOpenChange:e=>!e&&k(null),children:(0,a.jsxs)(u.cZ,{children:[(0,a.jsxs)(u.fK,{children:[(0,a.jsxs)(u.$N,{className:"capitalize",children:[C&&C.replace("_"," ")," Request"]}),(0,a.jsx)(u.Be,{children:"approve"===C?"Approve this refund? This does not auto-refund money, but marks it as Valid.":"refund_processed"===C?"Confirm that you have processed the refund transaction?":"Reject this refund request?"})]}),(0,a.jsxs)("div",{className:"py-2",children:[(0,a.jsx)(d._,{children:"Admin Note (Optional)"}),(0,a.jsx)(o.g,{value:R,onChange:e=>_(e.target.value),placeholder:"Reason or transaction ref...",className:"mt-2"})]}),(0,a.jsxs)(u.cN,{children:[(0,a.jsx)(i.z,{variant:"outline",onClick:()=>k(null),children:"Cancel"}),(0,a.jsxs)(i.z,{onClick:O,disabled:Z,variant:"reject"===C?"destructive":"default",className:"refund_processed"===C?"bg-green-600 hover:bg-green-700":"",children:[Z&&(0,a.jsx)(x.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Confirm"]})]})]})})]})}},53113:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(79205).Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},14064:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(79205).Z)("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]])}},function(e){e.O(0,[8590,6053,1,9923,90,2074,2971,2117,1744],function(){return e(e.s=9928)}),_N_E=e.O()}]);