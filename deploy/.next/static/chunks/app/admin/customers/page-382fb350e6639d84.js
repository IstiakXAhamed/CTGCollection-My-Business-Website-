(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6781],{44042:function(e,t,s){Promise.resolve().then(s.bind(s,580))},580:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return b}});var a=s(57437),r=s(2265),l=s(66070),i=s(95186),n=s(62869),c=s(73247),d=s(51817),o=s(95805),x=s(98617),m=s(14760),u=s(32489),p=s(30401),h=s(82023),f=s(48614),g=s(36891),y=s(26e3);function b(){var e,t,s,b;let[j,v]=(0,r.useState)([]),[N,w]=(0,r.useState)([]),[k,C]=(0,r.useState)(!0),[S,P]=(0,r.useState)(""),[z,Z]=(0,r.useState)(null),[R,T]=(0,r.useState)(!1),[E,I]=(0,r.useState)(!1),[A,_]=(0,r.useState)(null),[D,F]=(0,r.useState)(!1),[L,O]=(0,r.useState)(!1),[M,H]=(0,r.useState)(""),[B,J]=(0,r.useState)({page:1,limit:50,total:0,totalPages:1}),V=(0,r.useCallback)(async()=>{await Y(B.page),await U()},[B.page]);(0,y.w)(V),(0,r.useEffect)(()=>{Y(B.page),U(),fetch("/api/auth/me",{credentials:"include"}).then(e=>e.json()).then(e=>{e.user&&H(e.user.role)})},[B.page]);let Y=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;C(!0);try{let t=await fetch("/api/admin/users?page=".concat(e,"&limit=").concat(B.limit,"&includeLoyalty=true"),{credentials:"include"});if(t.ok){let e=await t.json();v(e.users||[]),e.pagination&&J(t=>({...t,page:e.pagination.page,total:e.pagination.total,totalPages:e.pagination.totalPages}))}}catch(e){console.error("Failed to fetch users:",e)}finally{C(!1)}},U=async()=>{try{let e=await fetch("/api/admin/loyalty/tiers",{credentials:"include"});if(e.ok){let t=await e.json();w(t.tiers||[])}}catch(e){console.error("Failed to fetch tiers:",e)}},W=async e=>{if(z){O(!0);try{(await fetch("/api/admin/users/assign-tier",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:z.id,tierId:e})})).ok&&(await Y(B.page),T(!1),Z(null))}catch(e){console.error("Failed to assign tier:",e)}finally{O(!1)}}},q=async e=>{Z(e),I(!0),_(null),F(!0);try{let t=await fetch("/api/ai/customer-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})});if(t.ok){let e=await t.json();_(e.analysis)}else{let e=await t.json();_({error:e.message||"Analysis failed"})}}catch(e){console.error("Failed to analyze persona:",e),_({error:"Network error occurred"})}finally{F(!1)}},G=j.filter(e=>{var t,s;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(S.toLowerCase()))||(null===(s=e.email)||void 0===s?void 0:s.toLowerCase().includes(S.toLowerCase()))}),K=e=>{var t;return(null===(t=e.loyaltyPoints)||void 0===t?void 0:t.tier)?(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold text-white",style:{backgroundColor:e.loyaltyPoints.tier.color},children:e.loyaltyPoints.tier.displayName}):(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-600",children:"No Tier"})};return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-1",children:"Customers"}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[B.total," total • Page ",B.page,"/",B.totalPages]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{className:"p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(c.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground"}),(0,a.jsx)(i.I,{placeholder:"Search...",value:S,onChange:e=>P(e.target.value),className:"pl-9 sm:pl-10 h-10 text-sm"})]})}),(0,a.jsx)(l.aY,{className:"p-2 sm:p-4",children:k?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(d.Z,{className:"w-6 h-6 animate-spin text-blue-600"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"lg:hidden space-y-2",children:G.map(e=>{var t;return(0,a.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(o.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-sm truncate",children:e.name}),(0,a.jsx)("p",{className:"text-[10px] sm:text-xs text-muted-foreground truncate",children:e.email})]}),K(e)]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"superadmin"===e.role?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:e.role}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:[(null===(t=e._count)||void 0===t?void 0:t.orders)||0," orders"]})]}),"superadmin"===M&&(0,a.jsxs)(n.z,{size:"sm",variant:"outline",className:"h-7 text-xs px-2",onClick:()=>{Z(e),T(!0)},children:[(0,a.jsx)(x.Z,{className:"w-3 h-3 mr-1"}),"Tier"]})]})]},e.id)})}),(0,a.jsx)("div",{className:"hidden lg:block overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Customer"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Email"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Phone"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Orders"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Role"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Membership Tier"}),(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Joined"}),"superadmin"===M&&(0,a.jsx)("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:G.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"py-4 px-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsx)("span",{className:"font-semibold",children:e.name})]})}),(0,a.jsx)("td",{className:"py-4 px-4 text-sm",children:e.email}),(0,a.jsx)("td",{className:"py-4 px-4 text-sm",children:e.phone||"N/A"}),(0,a.jsxs)("td",{className:"py-4 px-4",children:[(null===(t=e._count)||void 0===t?void 0:t.orders)||0," orders"]}),(0,a.jsx)("td",{className:"py-4 px-4",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"superadmin"===e.role?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:e.role})}),(0,a.jsx)("td",{className:"py-4 px-4",children:K(e)}),(0,a.jsx)("td",{className:"py-4 px-4 text-sm text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString()}),"superadmin"===M&&(0,a.jsxs)("td",{className:"py-4 px-4",children:[(0,a.jsxs)(n.z,{size:"sm",variant:"outline",className:"gap-1 mr-2",onClick:()=>q(e),children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 text-indigo-600"}),"Analyze"]}),(0,a.jsxs)(n.z,{size:"sm",variant:"outline",className:"gap-1",onClick:()=>{Z(e),T(!0)},children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),"Set Tier"]})]})]},e.id)})})]})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3 mt-4 pt-4 border-t",children:[(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-muted-foreground",children:[(B.page-1)*B.limit+1,"-",Math.min(B.page*B.limit,B.total)," of ",B.total]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>{B.page>1&&J(e=>({...e,page:e.page-1}))},disabled:B.page<=1,children:"Prev"}),(0,a.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs font-medium",children:B.page}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>{B.page<B.totalPages&&J(e=>({...e,page:e.page+1}))},disabled:B.page>=B.totalPages,children:"Next"})]})]})]})})]}),(0,a.jsx)(f.M,{children:R&&z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-40",onClick:()=>T(!1)}),(0,a.jsxs)(g.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed left-1/2 -translate-x-1/2 w-[90vw] max-w-md bg-white rounded-xl shadow-2xl z-50",style:{top:"60px",maxHeight:"calc(100vh - 80px)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-t-xl",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"w-5 h-5"}),"Assign Membership Tier"]}),(0,a.jsx)("button",{onClick:()=>T(!1),className:"p-1 hover:bg-white/20 rounded",children:(0,a.jsx)(u.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-4 overflow-y-auto",style:{maxHeight:"calc(100vh - 200px)"},children:[(0,a.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg border border-purple-200",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Assigning tier to:"}),(0,a.jsx)("p",{className:"font-semibold",children:z.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:z.email}),(null===(e=z.loyaltyPoints)||void 0===e?void 0:e.tier)&&(0,a.jsxs)("p",{className:"text-sm mt-2",children:["Current tier: ",(0,a.jsx)("span",{className:"font-semibold",style:{color:z.loyaltyPoints.tier.color},children:z.loyaltyPoints.tier.displayName})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Select Tier:"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{onClick:()=>W(null),disabled:L,className:"w-full p-3 border-2 rounded-lg text-left hover:border-gray-400 hover:bg-gray-50 transition flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-600",children:"No Tier"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Remove membership tier"})]}),!(null===(t=z.loyaltyPoints)||void 0===t?void 0:t.tierId)&&(0,a.jsx)(p.Z,{className:"w-5 h-5 text-green-600"})]}),N.map(e=>{var t,s,r;return(0,a.jsxs)("button",{onClick:()=>W(e.id),disabled:L,className:"w-full p-3 border-2 rounded-lg text-left hover:border-gray-400 transition flex items-center justify-between",style:{borderColor:(null===(t=z.loyaltyPoints)||void 0===t?void 0:t.tierId)===e.id?e.color:void 0,backgroundColor:(null===(s=z.loyaltyPoints)||void 0===s?void 0:s.tierId)===e.id?"".concat(e.color,"10"):void 0},children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:e.color},children:(0,a.jsx)(x.Z,{className:"w-4 h-4 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:e.displayName}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Min spend: ৳",e.minSpending.toLocaleString()]})]})]}),(null===(r=z.loyaltyPoints)||void 0===r?void 0:r.tierId)===e.id&&(0,a.jsx)(p.Z,{className:"w-5 h-5 text-green-600"})]},e.id)})]})]}),L&&(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-blue-600 py-2",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Updating..."})]})]})]})]})}),(0,a.jsx)(f.M,{children:E&&z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-40",onClick:()=>I(!1)}),(0,a.jsxs)(g.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed left-1/2 -translate-x-1/2 w-[90vw] max-w-lg bg-white rounded-xl shadow-2xl z-50",style:{top:"60px",maxHeight:"calc(100vh - 80px)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-t-xl",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5"}),"AI Customer Persona"]}),(0,a.jsx)("button",{onClick:()=>I(!1),className:"p-1 hover:bg-white/20 rounded",children:(0,a.jsx)(u.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(100vh - 200px)"},children:D?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[(0,a.jsx)(d.Z,{className:"w-10 h-10 animate-spin text-indigo-600 mb-3"}),(0,a.jsx)("p",{className:"font-medium",children:"Thinking..."}),(0,a.jsx)("p",{className:"text-xs",children:"Analyzing purchase history and patterns"})]}):A?A.error?(0,a.jsx)("div",{className:"text-center py-8 text-red-500",children:(0,a.jsxs)("p",{children:["Analysis failed: ",A.error]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("span",{className:"px-4 py-1.5 rounded-full text-sm font-bold shadow-sm ".concat("VIP"===A.result.segment?"bg-amber-100 text-amber-700 border border-amber-200":"At-Risk"===A.result.segment?"bg-red-100 text-red-700 border border-red-200":"bg-blue-100 text-blue-700 border border-blue-200"),children:[A.result.segment," Customer"]})}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border",children:(0,a.jsxs)("p",{className:"text-gray-700 italic text-center",children:['"',A.result.persona,'"']})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm flex items-center gap-2",children:"❤️ Preferences"}),(0,a.jsx)("ul",{className:"text-sm text-gray-600 list-disc pl-4 space-y-1",children:null===(s=A.result.preferences)||void 0===s?void 0:s.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-sm flex items-center gap-2",children:"\uD83D\uDECD️ Recommendations"}),(0,a.jsx)("ul",{className:"text-sm text-gray-600 list-disc pl-4 space-y-1",children:null===(b=A.result.recommendations)||void 0===b?void 0:b.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-100",children:[(0,a.jsxs)("h4",{className:"font-semibold text-sm text-green-800 mb-1 flex items-center gap-2",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"})," Recommended Strategy"]}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:A.result.retentionStrategy})]})]}):null})]})]})})]})}},62869:function(e,t,s){"use strict";s.d(t,{d:function(){return c},z:function(){return d}});var a=s(57437),r=s(2265),l=s(37053),i=s(90535),n=s(94508);let c=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:d=!1,...o}=e,x=d?l.g7:"button";return(0,a.jsx)(x,{className:(0,n.cn)(c({variant:r,size:i,className:s})),ref:t,...o})});d.displayName="Button"},66070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return n},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var a=s(57437),r=s(2265),l=s(94508);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});i.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...r})});n.displayName="CardHeader";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});c.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})});d.displayName="CardDescription";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...r})});o.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},95186:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(57437),r=s(2265),l=s(94508);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},26e3:function(e,t,s){"use strict";s.d(t,{w:function(){return r}});var a=s(2265);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{interval:s=3e4,refreshOnFocus:r=!0,enabled:l=!0}=t,i=(0,a.useRef)(e),n=(0,a.useRef)(null);(0,a.useEffect)(()=>{i.current=e},[e]);let c=(0,a.useCallback)(()=>{"visible"===document.visibilityState&&r&&l&&i.current()},[r,l]);return(0,a.useEffect)(()=>{if(l)return n.current=setInterval(()=>{i.current()},s),r&&document.addEventListener("visibilitychange",c),()=>{n.current&&clearInterval(n.current),r&&document.removeEventListener("visibilitychange",c)}},[s,r,l,c]),{refresh:(0,a.useCallback)(()=>{i.current()},[])}}},94508:function(e,t,s){"use strict";s.d(t,{T4:function(){return i},cn:function(){return l}});var a=s(61994),r=s(53335);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}function i(e){return new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT",minimumFractionDigits:0}).format(e)}}},function(e){e.O(0,[8590,6891,4259,2971,2117,1744],function(){return e(e.s=44042)}),_N_E=e.O()}]);