"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1206],{21206:function(e,t,s){s.d(t,{B:function(){return w}});var a=s(57437),r=s(2265),n=s(99397),l=s(73247),i=s(32660),o=s(71533),d=s(59196),c=s(76980),u=s(44743),f=s(92369),x=s(62869),m=s(95186),h=s(19378),g=s(27954),p=s(94508);let b=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(g.fC,{ref:t,className:(0,p.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});b.displayName=g.fC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(g.Ee,{ref:t,className:(0,p.cn)("aspect-square h-full w-full",s),...r})}).displayName=g.Ee.displayName;let v=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(g.NY,{ref:t,className:(0,p.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});v.displayName=g.NY.displayName;var j=s(35974),N=s(26110),y=s(85010);function w(){let[e,t]=(0,r.useState)([]),[s,g]=(0,r.useState)(null),[p,w]=(0,r.useState)([]),[k,S]=(0,r.useState)(""),[C,z]=(0,r.useState)(!0),[I,R]=(0,r.useState)(!1),[D,Z]=(0,r.useState)(!1),[A,E]=(0,r.useState)(""),[T,V]=(0,r.useState)([]),[_,M]=(0,r.useState)(!1),F=(0,r.useRef)(null),[q,B]=(0,r.useState)(""),O=async()=>{try{let e=await fetch("/api/internal-chat/conversations");if(e.ok){let s=await e.json();t(s.conversations||[])}}catch(e){console.error("Failed to fetch conversations")}finally{z(!1)}};(0,r.useEffect)(()=>{fetch("/api/auth/me").then(e=>e.json()).then(e=>{e.user&&B(e.user.id)}),O();let e=setInterval(O,1e4);return()=>clearInterval(e)},[]);let Y=async()=>{if(s)try{let e=await fetch("/api/internal-chat/messages?userId=".concat(s.id));if(e.ok){let t=await e.json();w(t.messages||[]),O()}}catch(e){console.error("Failed to fetch messages")}};(0,r.useEffect)(()=>{if(Y(),s){let e=setInterval(Y,3e3);return()=>clearInterval(e)}},[s]),(0,r.useEffect)(()=>{var e;null===(e=F.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[p]);let K=async()=>{if(!s||!k.trim())return;let e={id:Date.now().toString(),content:k,createdAt:new Date().toISOString(),senderId:q,isRead:!1};w(t=>[...t,e]),S(""),R(!0);try{(await fetch("/api/internal-chat/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:s.id,content:e.content})})).ok&&(Y(),O())}catch(e){console.error("Send failed")}finally{R(!1)}};(0,r.useEffect)(()=>{if(!D||!A){V([]);return}let e=setTimeout(async()=>{M(!0);try{let e=await fetch("/api/internal-chat/users?query=".concat(A));if(e.ok){let t=await e.json();V(t.users||[])}}finally{M(!1)}},500);return()=>clearTimeout(e)},[A,D]);let $=s=>{g(s),Z(!1),e.find(e=>e.user.id===s.id)||t(e=>[{user:s,lastMessage:{content:"",createdAt:new Date().toISOString(),isRead:!0,amISender:!0},unreadCount:0},...e])};return(0,a.jsxs)("div",{className:"flex h-[600px] w-full border rounded-xl overflow-hidden bg-white shadow-sm relative",children:[(0,a.jsxs)("div",{className:"".concat(s?"hidden md:flex":"flex"," w-full md:w-80 border-r bg-gray-50 flex-col md:flex"),children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between bg-white",children:[(0,a.jsx)("h2",{className:"font-semibold text-gray-800",children:"Messages"}),(0,a.jsxs)(N.Vq,{open:D,onOpenChange:Z,children:[(0,a.jsx)(N.hg,{asChild:!0,children:(0,a.jsx)(x.z,{size:"icon",variant:"ghost",className:"h-8 w-8 rounded-full hover:bg-gray-100",children:(0,a.jsx)(n.Z,{className:"h-5 w-5 text-blue-600"})})}),(0,a.jsxs)(N.cZ,{children:[(0,a.jsx)(N.fK,{children:(0,a.jsx)(N.$N,{children:"New Message"})}),(0,a.jsxs)("div",{className:"space-y-4 pt-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.Z,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.I,{placeholder:"Search people...",className:"pl-9",value:A,onChange:e=>E(e.target.value)})]}),(0,a.jsx)(h.x,{className:"h-[300px]",children:_?(0,a.jsx)("div",{className:"p-4 text-center text-sm text-gray-500",children:"Searching..."}):T.length>0?(0,a.jsx)("div",{className:"space-y-2",children:T.map(e=>(0,a.jsxs)("div",{onClick:()=>$(e),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 cursor-pointer transition select-none",children:[(0,a.jsx)(b,{className:"h-10 w-10",children:(0,a.jsx)(v,{className:"bg-blue-100 text-blue-600",children:e.name.charAt(0)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(j.C,{variant:"outline",className:"text-[10px] py-0 h-4",children:e.role}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:e.email})]})]})]},e.id))}):A?(0,a.jsx)("div",{className:"p-4 text-center text-sm text-gray-500",children:"No users found."}):(0,a.jsx)("div",{className:"p-4 text-center text-sm text-gray-400",children:"Type to search admins or sellers."})})]})]})]})]}),(0,a.jsx)(h.x,{className:"flex-1",children:0!==e.length||C?(0,a.jsx)("div",{className:"flex flex-col",children:e.map(e=>(0,a.jsxs)("div",{onClick:()=>g(e.user),className:"p-4 border-b flex gap-3 cursor-pointer transition hover:bg-gray-100 ".concat((null==s?void 0:s.id)===e.user.id?"bg-blue-50 border-l-4 border-l-blue-600 hover:bg-blue-50":"border-l-4 border-l-transparent"),children:[(0,a.jsx)(b,{children:(0,a.jsx)(v,{className:(null==s?void 0:s.id)===e.user.id?"bg-blue-200 text-blue-800":"bg-gray-200",children:e.user.name.charAt(0)})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,a.jsx)("span",{className:"font-medium truncate ".concat(e.unreadCount>0?"text-black":"text-gray-700"),children:e.user.name}),e.lastMessage.createdAt&&(0,a.jsx)("span",{className:"text-[10px] text-gray-400 whitespace-nowrap ml-2",children:(0,y.Q)(new Date(e.lastMessage.createdAt),{addSuffix:!1})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"text-xs truncate max-w-[140px] ".concat(e.unreadCount>0?"font-semibold text-gray-900":"text-gray-500"),children:[e.lastMessage.amISender&&"You: ",e.lastMessage.content]}),e.unreadCount>0&&(0,a.jsx)("span",{className:"h-5 w-5 bg-blue-600 text-white text-[10px] rounded-full flex items-center justify-center font-bold",children:e.unreadCount})]})]})]},e.user.id))}):(0,a.jsxs)("div",{className:"p-8 text-center text-sm text-gray-500",children:["No messages yet.",(0,a.jsx)("br",{}),"Start a new chat!"]})})]}),(0,a.jsx)("div",{className:"".concat(s?"flex":"hidden md:flex"," flex-1 flex-col bg-slate-50 w-full"),children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"h-16 border-b bg-white flex items-center justify-between px-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x.z,{variant:"ghost",size:"icon",className:"md:hidden -ml-2",onClick:()=>g(null),children:(0,a.jsx)(i.Z,{className:"h-5 w-5"})}),(0,a.jsx)(b,{className:"h-10 w-10",children:(0,a.jsx)(v,{className:"bg-blue-600 text-white",children:s.name.charAt(0)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-800",children:s.name}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 capitalize",children:s.role})]})]})]}),(0,a.jsx)(x.z,{variant:"ghost",size:"icon",children:(0,a.jsx)(o.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,a.jsx)(h.x,{className:"flex-1 p-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[p.map((e,t)=>{let s=e.senderId===q;return(0,a.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[70%] p-3 rounded-2xl shadow-sm text-sm ".concat(s?"bg-blue-600 text-white rounded-br-none":"bg-white text-gray-800 border rounded-bl-none"),children:[(0,a.jsx)("p",{children:e.content}),(0,a.jsxs)("div",{className:"text-[10px] mt-1 flex items-center justify-end gap-1 ".concat(s?"text-blue-200":"text-gray-400"),children:[new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s&&(e.isRead?(0,a.jsx)(d.Z,{className:"h-3 w-3"}):(0,a.jsx)("span",{className:"text-[10px]",children:"âœ“"}))]})]})},e.id)}),(0,a.jsx)("div",{ref:F})]})}),(0,a.jsx)("div",{className:"p-4 bg-white border-t",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.z,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(c.Z,{className:"h-5 w-5"})}),(0,a.jsx)(m.I,{value:k,onChange:e=>S(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&K(),placeholder:"Type a message...",className:"flex-1 bg-gray-50 border-gray-200 focus:bg-white transition-colors"}),(0,a.jsx)(x.z,{onClick:K,disabled:!k.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white w-10 h-10 p-0 rounded-lg",children:(0,a.jsx)(u.Z,{className:"h-5 w-5 ml-0.5"})})]})})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(f.Z,{className:"h-10 w-10 text-gray-300"})}),(0,a.jsx)("p",{className:"font-medium",children:"Select a conversation to start chatting"})]})})]})}},35974:function(e,t,s){s.d(t,{C:function(){return i}});var a=s(57437);s(2265);var r=s(90535),n=s(94508);let l=(0,r.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:s}),t),...r})}},62869:function(e,t,s){s.d(t,{d:function(){return o},z:function(){return d}});var a=s(57437),r=s(2265),n=s(37053),l=s(90535),i=s(94508);let o=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(o({variant:r,size:l,className:s})),ref:t,...c})});d.displayName="Button"},26110:function(e,t,s){s.d(t,{$N:function(){return h},Be:function(){return g},Vq:function(){return o},cN:function(){return m},cZ:function(){return f},fK:function(){return x},hg:function(){return d}});var a=s(57437),r=s(2265),n=s(70001),l=s(32489),i=s(94508);let o=n.fC,d=n.xz,c=n.h_;n.x8;let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});u.displayName=n.aV.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,...o}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)(n.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[r,(0,a.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=n.VY.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};x.displayName="DialogHeader";let m=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};m.displayName="DialogFooter";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});h.displayName=n.Dx.displayName;let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});g.displayName=n.dk.displayName},95186:function(e,t,s){s.d(t,{I:function(){return l}});var a=s(57437),r=s(2265),n=s(94508);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});l.displayName="Input"},19378:function(e,t,s){s.d(t,{x:function(){return i}});var a=s(57437),r=s(2265),n=s(90314),l=s(94508);let i=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(n.fC,{ref:t,className:(0,l.cn)("relative overflow-hidden",s),...i,children:[(0,a.jsx)(n.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(o,{}),(0,a.jsx)(n.Ns,{})]})});i.displayName=n.fC.displayName;let o=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...i}=e;return(0,a.jsx)(n.gb,{ref:t,orientation:r,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...i,children:(0,a.jsx)(n.q4,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=n.gb.displayName},94508:function(e,t,s){s.d(t,{T4:function(){return l},cn:function(){return n}});var a=s(61994),r=s(53335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}function l(e){return new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT",minimumFractionDigits:0}).format(e)}}}]);